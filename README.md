# ğŸ§¨ çƒŸèŠ±ç²’å­ç³»ç»Ÿ

## âœ¨ ä¸€ã€é¡¹ç›®ç®€ä»‹

æœ¬é¡¹ç›®åŸºäº **OpenGL 3.3 + GLFW/GLAD** æ­å»ºï¼Œå®ç°äº†ä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€è§†è§‰ç²¾ç¾çš„ **3D çƒŸèŠ±ç²’å­ç³»ç»Ÿ**ã€‚é¡¹ç›®é›†æˆäº†ç²’å­ç‰©ç†ã€åŠ¨æ€å…‰ç…§ã€åå¤„ç†æ¸²æŸ“ã€3Dåœºæ™¯å»ºæ¨¡ã€éŸ³æ•ˆç³»ç»Ÿã€äº¤äº’æ§åˆ¶ç­‰å¤šä¸ªæ¨¡å—ï¼Œæä¾›äº†æ²‰æµ¸å¼çš„è§†è§‰ä½“éªŒã€‚

### æ ¸å¿ƒç‰¹æ€§

#### 1. å¤šæ ·åŒ–çƒŸèŠ±ç²’å­ç³»ç»Ÿ

- **6ç§çƒŸèŠ±ç±»å‹**ï¼šçƒå½¢ã€ç¯å½¢ã€å¿ƒå½¢ã€èºæ—‹ã€å¤šå±‚ã€å›¾ç‰‡çƒŸèŠ±
- **åŒè‰²äºŒæ¬¡çˆ†ç‚¸**ï¼šä¸»è‰²+è¾…è‰²çš„äºŒæ¬¡ç»½æ”¾æ•ˆæœ
- **ç‰©ç†æ¨¡æ‹Ÿ**ï¼šé‡åŠ›åŠ é€Ÿåº¦ã€ç©ºæ°”é˜»åŠ›ã€åˆé€Ÿåº¦æ§åˆ¶
- **ç²’å­æ‹–å°¾**ï¼šä¸Šå‡é˜¶æ®µçš„åŠ¨æ€æ‹–å°¾ç‰¹æ•ˆ
- **é¢œè‰²æ¸å˜**ï¼šä»äº®è‰²åˆ°æš—è‰²çš„è‡ªç„¶è¿‡æ¸¡

#### 2. å®Œæ•´çš„3Dåœºæ™¯æ¸²æŸ“

- **ç«‹æ–¹ä½“è´´å›¾å¤©ç©ºç›’**ï¼š6é¢å¤œç©ºçº¹ç†ï¼Œè¥é€ æ²‰æµ¸æ„Ÿ
- **Blinn-Phongå…‰ç…§åœ°é¢**ï¼šæ”¯æŒçº¹ç†è´´å›¾ã€é•œé¢åå°„ã€åŒé‡é›¾æ•ˆï¼ˆè·ç¦»é›¾+é«˜åº¦é›¾ï¼‰
- **Assimpæ¨¡å‹åŠ è½½**ï¼šä¹¦æœ¬3Dæ¨¡å‹ï¼Œæ”¯æŒå¤šç½‘æ ¼ã€å¤šçº¹ç†
- **ç‚¹å…‰æºç³»ç»Ÿ**ï¼šæœ€å¤š16ä¸ªåŠ¨æ€å…‰æºï¼ˆ4ä¸ªæ°¸ä¹…åœºæ™¯å…‰+12ä¸ªä¸´æ—¶çƒŸèŠ±å…‰ï¼‰

#### 3. æ‘„åƒæœºä¸æ¼”ç¤ºç³»ç»Ÿ

- **è‡ªç”±è§†è§’æ¨¡å¼**ï¼šWASDç§»åŠ¨ + é¼ æ ‡æ§åˆ¶è§†è§’
- **è½¨é“ç¯ç»•æ¨¡å¼**ï¼ˆæŒ‰é”®Rï¼‰ï¼šè‡ªåŠ¨å›´ç»•åœºæ™¯æ—‹è½¬
- **ç”µå½±è¿é•œæ¨¡å¼**ï¼ˆæŒ‰é”®9ï¼‰ï¼š11ç§’ä¸‰é˜¶æ®µè‡ªåŠ¨é•œå¤´åŠ¨ç”»
  - é«˜ç©ºä¿¯ç°ä¸‹é™ â†’ ç¯ç»•é£è¡Œ+æ™ƒåŠ¨ â†’ é™è½è‡³è§‚èµç‚¹
- **æ·¡å…¥æ·¡å‡ºåå¤„ç†**ï¼šé˜¶æ®µåˆ‡æ¢æ—¶çš„å¹³æ»‘è¿‡æ¸¡æ•ˆæœ
- **è‡ªåŠ¨æ¼”ç¤ºæ¨¡å¼**ï¼šæŒ‰é”®0å¯åŠ¨è‡ªåŠ¨çƒŸèŠ±åºåˆ—ï¼ŒæŒ‰é”®9+0å®ç°å®Œæ•´æ¼”ç¤º 

#### 4. åå¤„ç†ä¸èµ„æºç®¡ç†

- **FBOç¦»å±æ¸²æŸ“**ï¼šåœºæ™¯å…ˆæ¸²æŸ“åˆ°å¸§ç¼“å†²ï¼Œå†åº”ç”¨åå¤„ç†
- **éŸ³æ•ˆç³»ç»Ÿ**ï¼šminiaudioå¼•æ“ï¼ŒçƒŸèŠ±ä¸Šå‡/çˆ†ç‚¸éŸ³æ•ˆ
- **èµ„æºç»Ÿä¸€ç®¡ç†**ï¼šOpenGLå¯¹è±¡çš„è§„èŒƒåŒ–åˆå§‹åŒ–ä¸æ¸…ç†

#### 5. äº¤äº’å¼UIç³»ç»Ÿ

- **FreeTypeæ–‡æœ¬æ¸²æŸ“**ï¼šæ”¯æŒä¸­è‹±æ–‡æ˜¾ç¤º
- **å®æ—¶ä¿¡æ¯**ï¼šFPSã€çƒŸèŠ±è®¡æ•°ã€å…‰æºæ•°é‡ã€æ“ä½œæç¤º
- **è‰ºæœ¯å­—åŠ¨ç”»**ï¼šF1-F6è§¦å‘çš„åŠ¨æ€æ–‡å­—ç‰¹æ•ˆ



## ğŸ§© äºŒã€ç»„å†…åˆ†å·¥

| å›¢é˜Ÿæˆå‘˜ | èŒè´£               | å…·ä½“                                                         |
| -------- | ------------------ | ------------------------------------------------------------ |
| åº„ä»•è±ª   | ä¸»æ¶æ„ä¸å±•ç¤º       | 1ã€å®ç°æ‘„åƒæœºã€å¤©ç©ºç›’ã€åœ°é¢ã€æ¨¡å‹ã€åæ ‡ç³»ç»Ÿã€‚è®¾è®¡æ•´ä½“é¡¹ç›®å¹¶æ­å»ºç»“æ„<br />2ã€å®ç°æ‘„åƒæœºè½¨é“ã€ç”»é¢çš„æ·¡å…¥æ·¡å‡ºåå¤„ç†ã€çƒŸèŠ±å±•ç¤ºåºåˆ—ä¸æ•´ä½“å‚æ•°è°ƒè¯•<br />3ã€ç¼–å†™æ–‡æ¡£å’Œåˆ¶ä½œppt |
| å‘¨å®æ°   | ç²’å­æ¨¡å‹ä¸çƒŸèŠ±é€»è¾‘ | 1ã€å®ç°çƒŸèŠ±ç²’å­çš„åŸºç¡€æ¨¡å‹å’ŒçƒŸèŠ±å‘å°„ï¼Œçˆ†ç‚¸ï¼Œæ›´æ–°ä¸äºŒæ¬¡çˆ†ç‚¸ã€‚<br />2ã€è‡ªå®šä¹‰çƒŸèŠ±ç±»å‹å’Œæ‹–å°¾å‡½æ•°ï¼›å®ç°å›¾ç‰‡ç±»å‹çƒŸèŠ±ç›¸å…³åŠŸèƒ½ |
| éƒ‘æµ©     | åå¤„ç†ä¸èµ„æºç®¡ç†   | 1ã€åå¤„ç†æ¸²æŸ“æµç¨‹ï¼šç¦»å±æ¸²æŸ“ã€äº®éƒ¨æå–ã€é«˜æ–¯æ¨¡ç³Šç­‰<br />2ã€èµ„æºç®¡ç†ï¼šå¯¹ OpenGL èµ„æºè¿›è¡Œç»Ÿä¸€åˆå§‹åŒ–ã€ä½¿ç”¨ä¸é‡Šæ”¾ç®¡ç†ï¼Œä¿è¯ç³»ç»Ÿç¨³å®šæ€§ã€‚ |
| é’Ÿæ™¨æ™–   | UIç•Œé¢ä¸è‰ºæœ¯å­—     | 1ã€ å“åº”å¼UIå¸ƒå±€ã€é¼ æ ‡å°„çº¿æ£€æµ‹ã€çŠ¶æ€è·Ÿè¸ªã€æ–‡æœ¬æ¸²æŸ“<br />2ã€è‰ºæœ¯å­—åŠ¨ç”»ã€é¢œè‰²çŠ¶æ€æ˜¾ç¤ºã€æ•°æ®ç›‘æ§ã€æ“ä½œæç¤ºã€ä¸­æ–‡æ”¯æŒ |
| ç‹å¤©èµ   | éŸ³æ•ˆä¸éšæœºåŒ–       | çƒŸèŠ±éŸ³æ•ˆä¸éšæœºçƒŸèŠ±é¢œè‰²ã€ä½ç½®ã€é«˜åº¦                           |

------

## ğŸ¥ ä¸‰ã€å±•ç¤ºè§†é¢‘

è§†é¢‘é“¾æ¥ï¼š[ä¸­å¤§çƒŸèŠ±ç²’å­ç³»ç»Ÿâ€”â€”è®¡å›¾æœŸæœ«ä½œä¸š_ å“”å“©å“”å“©_ bilibili](https://www.bilibili.com/video/BV1dmqhB3EUq/?vd_source=11f2137d6276ac03fd493958370ff17e)



## ğŸ¯ å››ã€å®ç°æ–¹æ³•

### 1. æ¸²æŸ“ç®¡çº¿æ¶æ„

#### 1.1 OpenGLæ¸²æŸ“æµç¨‹

é¡¹ç›®é‡‡ç”¨**åŒç¼“å†²+FBOç¦»å±æ¸²æŸ“**æ¶æ„ï¼Œå®Œæ•´æ¸²æŸ“ç®¡çº¿å¦‚ä¸‹ï¼š

```
ä¸»æ¸²æŸ“å¾ªç¯ï¼ˆmain.cppï¼‰
â”œâ”€ postProcessor->Bind()  // ç»‘å®šFBOï¼Œæ‰€æœ‰åœºæ™¯æ¸²æŸ“åˆ°ç¦»å±çº¹ç†
â”œâ”€ åœºæ™¯æ¸²æŸ“é˜¶æ®µ
â”‚  â”œâ”€ æ¸…ç©ºé¢œè‰²+æ·±åº¦ç¼“å†²
â”‚  â”œâ”€ è®¡ç®—MVPçŸ©é˜µï¼ˆprojection, view, modelï¼‰
â”‚  â”œâ”€ ç»˜åˆ¶åœ°é¢ï¼ˆBlinn-Phongå…‰ç…§+é›¾æ•ˆï¼‰
â”‚  â”œâ”€ ç»˜åˆ¶æ¨¡å‹ï¼ˆAssimpåŠ è½½çš„ä¹¦æœ¬ï¼‰
â”‚  â”œâ”€ ç»˜åˆ¶å¤©ç©ºç›’ï¼ˆæ·±åº¦æµ‹è¯•ä¼˜åŒ–ï¼‰
â”‚  â””â”€ ç»˜åˆ¶çƒŸèŠ±ç²’å­ï¼ˆåŠé€æ˜å åŠ ï¼‰
â”œâ”€ postProcessor->Unbind()  // æ¢å¤é»˜è®¤å¸§ç¼“å†²
â”œâ”€ åå¤„ç†é˜¶æ®µ
â”‚  â”œâ”€ è·å–ç”µå½±æ¨¡å¼æ·¡å…¥æ·¡å‡ºalpha
â”‚  â”œâ”€ åº”ç”¨åå¤„ç†shaderï¼ˆå…¨å±å››è¾¹å½¢ï¼‰
â”‚  â””â”€ æ¸²æŸ“åˆ°å±å¹•
â”œâ”€ UIæ¸²æŸ“ï¼ˆFreeTypeæ–‡æœ¬ï¼‰
â””â”€ glfwSwapBuffers()  // äº¤æ¢å‰åç¼“å†²
```

**å…³é”®æŠ€æœ¯ç‚¹**ï¼š

- **FBOç¦»å±æ¸²æŸ“**ï¼šåœºæ™¯å…ˆæ¸²æŸ“åˆ°çº¹ç†ï¼Œä¾¿äºåå¤„ç†ï¼ˆå¦‚æ·¡å…¥æ·¡å‡ºã€æ³›å…‰ç­‰ï¼‰
- **æ·±åº¦æµ‹è¯•ä¼˜åŒ–**ï¼šå¤©ç©ºç›’ä½¿ç”¨`GL_LEQUAL`ç¡®ä¿åœ¨æœ€è¿œå¤„ï¼ŒçƒŸèŠ±ç²’å­å…³é—­æ·±åº¦å†™å…¥ä½†ä¿ç•™æ·±åº¦æµ‹è¯•
- **æ¸²æŸ“é¡ºåº**ï¼šä¸é€æ˜ç‰©ä½“ï¼ˆåœ°é¢/æ¨¡å‹ï¼‰â†’ å¤©ç©ºç›’ â†’ åŠé€æ˜ç²’å­ï¼ˆç”±è¿œåˆ°è¿‘æ’åºï¼‰

#### 1.2 åæ ‡ç³»ç»Ÿä¸MVPå˜æ¢

**OpenGLå³æ‰‹åæ ‡ç³»**ï¼š

- Xè½´ï¼šå³ä¸ºæ­£
- Yè½´ï¼šä¸Šä¸ºæ­£
- Zè½´ï¼šå±å¹•å¤–ä¸ºæ­£ï¼ˆè§‚å¯Ÿè€…æœå‘-Zï¼‰

**MVPå˜æ¢ç®¡çº¿**ï¼š

```cpp
// 1. æ¨¡å‹çŸ©é˜µï¼ˆå±€éƒ¨ç©ºé—´ â†’ ä¸–ç•Œç©ºé—´ï¼‰
glm::mat4 model = glm::translate(...) * glm::rotate(...) * glm::scale(...);

// 2. è§†å›¾çŸ©é˜µï¼ˆä¸–ç•Œç©ºé—´ â†’ è§‚å¯Ÿç©ºé—´ï¼‰
glm::mat4 view = camera.GetViewMatrix();  // glm::lookAt

// 3. æŠ•å½±çŸ©é˜µï¼ˆè§‚å¯Ÿç©ºé—´ â†’ è£å‰ªç©ºé—´ï¼‰
glm::mat4 projection = glm::perspective(
    glm::radians(camera.Zoom),  // FOV = 45åº¦
    (float)SCR_WIDTH / SCR_HEIGHT,
    0.1f,   // è¿‘å¹³é¢
    200.0f  // è¿œå¹³é¢
);

// é¡¶ç‚¹ç€è‰²å™¨åº”ç”¨
gl_Position = projection * view * model * vec4(aPos, 1.0);
```

---

### 2. æ‘„åƒæœºç³»ç»Ÿ

#### 2.1 æ¬§æ‹‰è§’å®ç°

ä½¿ç”¨**Yawï¼ˆåèˆªè§’ï¼‰å’ŒPitchï¼ˆä¿¯ä»°è§’ï¼‰**æ§åˆ¶æ‘„åƒæœºæœå‘ï¼š

```cpp
glm::vec3 front;
front.x = cos(glm::radians(Yaw)) * cos(glm::radians(Pitch));
front.y = sin(glm::radians(Pitch));
front.z = sin(glm::radians(Yaw)) * cos(glm::radians(Pitch));
Front = glm::normalize(front);
```

**ä¸‡å‘é”è§£å†³**ï¼šé™åˆ¶Pitchåœ¨[-89Â°, 89Â°]ï¼Œé¿å…å‚ç›´æœå‘å¯¼è‡´çš„è‡ªç”±åº¦ä¸¢å¤±ã€‚

#### 2.2 ä¸‰ç§æ‘„åƒæœºæ¨¡å¼

**è‡ªç”±æ¨¡å¼**ï¼š

- é”®ç›˜ï¼š`Position += Front * velocity`ï¼ˆWASDï¼‰
- é¼ æ ‡ï¼š`Yaw += xoffset`, `Pitch += yoffset`

**è½¨é“æ¨¡å¼**ï¼ˆæŒ‰é”®Rï¼‰ï¼š

```cpp
float angleRad = glm::radians(OrbitAngle);
Position.x = OrbitCenter.x + OrbitRadius * cos(angleRad);
Position.z = OrbitCenter.z + OrbitRadius * sin(angleRad);
Front = normalize(OrbitCenter - Position);  // å§‹ç»ˆæ³¨è§†ä¸­å¿ƒ
```

**ç”µå½±æ¨¡å¼**ï¼ˆæŒ‰é”®9ï¼‰ï¼š

- **é˜¶æ®µä¸€ï¼ˆ0-3.5sï¼‰**ï¼šé«˜ç©ºä¿¯ç°ï¼Œ`Position.y`ä»7é™è‡³4ï¼Œ`Position.z`ä»27é™è‡³17
- **é˜¶æ®µäºŒï¼ˆ3.5-8.5sï¼‰**ï¼šç¯ç»•è½¨é“22å•ä½åŠå¾„ï¼Œå åŠ sin/cosæ™ƒåŠ¨ï¼ˆå¹…åº¦0.12ï¼‰
- **é˜¶æ®µä¸‰ï¼ˆ8.5-11sï¼‰**ï¼šä½¿ç”¨`smoothstep`å¹³æ»‘é™è½ï¼ŒPitchä»-8Â°å‡è‡³15Â°ï¼ˆä»°è§†ï¼‰

**æ·¡å…¥æ·¡å‡º**ï¼šåœ¨é˜¶æ®µåˆ‡æ¢æ—¶ï¼ˆ3.0-4.0s, 8.0-9.0sï¼‰è¿”å›alphaå€¼ï¼Œåº”ç”¨åˆ°åå¤„ç†shaderã€‚

---

### 3. åœºæ™¯æ¸²æŸ“æ¨¡å—

#### 3.1 å¤©ç©ºç›’ç³»ç»Ÿ

**ç«‹æ–¹ä½“è´´å›¾åŸç†**ï¼š

- ä½¿ç”¨6å¼ çº¹ç†ï¼ˆpx/nx/py/ny/pz/nzï¼‰æ„æˆcubemap
- é¡¶ç‚¹ç€è‰²å™¨ï¼š`TexCoords = aPos`ï¼ˆé¡¶ç‚¹ä½ç½®ç›´æ¥ä½œä¸ºé‡‡æ ·æ–¹å‘ï¼‰
- æ·±åº¦ä¼˜åŒ–ï¼š`gl_Position = (projection * view * vec4(aPos, 1.0)).xyww`
  - å°†zåˆ†é‡æ›¿æ¢ä¸ºwï¼Œç¡®ä¿æ·±åº¦å€¼æ’ä¸º1.0ï¼ˆæœ€è¿œå¤„ï¼‰
  - é…åˆ`glDepthFunc(GL_LEQUAL)`é€šè¿‡æ·±åº¦æµ‹è¯•

**äº®åº¦è°ƒæ•´**ï¼šé€šè¿‡åœ¨ç‰‡æ®µç€è‰²å™¨ä¹˜ä»¥ç³»æ•°ï¼ˆ0.3ï¼‰é™ä½å¤œç©ºäº®åº¦ï¼ŒåŒ¹é…åœ°é¢é›¾æ•ˆé¢œè‰²ã€‚

#### 3.2 åœ°é¢ç³»ç»Ÿï¼ˆBlinn-Phong + åŒé‡é›¾æ•ˆï¼‰

**Blinn-Phongå…‰ç…§æ¨¡å‹**ï¼š

```glsl
// ç¯å¢ƒå…‰
vec3 ambient = 0.1 * lightColor;

// æ¼«åå°„
float diff = max(dot(normal, lightDir), 0.0);
vec3 diffuse = diff * lightColor;

// Blinn-Phongé•œé¢åå°„
vec3 halfwayDir = normalize(lightDir + viewDir);
float spec = pow(max(dot(normal, halfwayDir), 0.0), shininess);
vec3 specular = specularStrength * spec * lightColor;
```

**åŒé‡é›¾æ•ˆ**ï¼š

```glsl
// è·ç¦»é›¾ï¼ˆæŒ‡æ•°è¡°å‡ï¼‰
float distance = length(FragPos - viewPos);
float fogFactor1 = exp(-fogDensity * max(0.0, distance - fogStart));

// é«˜åº¦é›¾ï¼ˆYè½´è¡°å‡ï¼‰
float heightFactor = max(0.0, FragPos.y - 0.0) / 10.0;
float fogFactor2 = 1.0 - clamp(heightFactor, 0.0, 1.0);

// ç»„åˆé›¾æ•ˆ
float finalFog = fogFactor1 * (1.0 - fogFactor2 * 0.3);
color = mix(fogColor, color, finalFog);
```

**çº¹ç†UVå¹³é“º**ï¼š`TexCoords = aTexCoords * textureRepeat`ï¼ˆrepeat=20ï¼‰ï¼Œå®ç°å¤§å°ºå¯¸åœ°é¢çš„çº¹ç†é‡å¤ã€‚

#### 3.3 æ¨¡å‹åŠ è½½ç³»ç»Ÿï¼ˆAssimpï¼‰

**é€’å½’åœºæ™¯å›¾éå†**ï¼š

```cpp
void Model::processNode(aiNode* node, const aiScene* scene) {
    // å¤„ç†å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰ç½‘æ ¼
    for (unsigned int i = 0; i < node->mNumMeshes; i++) {
        aiMesh* mesh = scene->mMeshes[node->mMeshes[i]];
        meshes.push_back(processMesh(mesh, scene));
    }
    // é€’å½’å¤„ç†å­èŠ‚ç‚¹
    for (unsigned int i = 0; i < node->mNumChildren; i++) {
        processNode(node->mChildren[i], scene);
    }
}
```

**çº¹ç†è·¯å¾„å®¹é”™**ï¼š

- æå–è£¸æ–‡ä»¶åï¼ˆå»é™¤è·¯å¾„ï¼‰
- åœ¨`æ¨¡å‹ç›®å½•/textures/`ã€`æ¨¡å‹ç›®å½•/`ã€`æ¨¡å‹çˆ¶ç›®å½•/textures/`ç­‰å¤šè·¯å¾„æœç´¢
- æ‰¾åˆ°ç¬¬ä¸€ä¸ªå­˜åœ¨çš„æ–‡ä»¶å³åŠ è½½ï¼Œæå‡å…¼å®¹æ€§

**Meshæ•°æ®ç»“æ„**ï¼š

```cpp
struct Vertex {
    glm::vec3 Position;
    glm::vec3 Normal;
    glm::vec2 TexCoords;
};

class Mesh {
    vector<Vertex> vertices;
    vector<unsigned int> indices;
    vector<Texture> textures;
    unsigned int VAO, VBO, EBO;
    
    void setupMesh() {
        glGenVertexArrays(1, &VAO);
        glBindVertexArray(VAO);
        // ä¸Šä¼ verticesåˆ°VBOï¼Œindicesåˆ°EBO
        // é…ç½®é¡¶ç‚¹å±æ€§æŒ‡é’ˆ
    }
};
```

---

### 4. çƒŸèŠ±ç²’å­ç³»ç»Ÿ

#### 4.1 ç²’å­æ•°æ®ç»“æ„

```cpp
struct Particle {
    glm::vec3 position, velocity;
    glm::vec4 color, initialColor, secondaryColor;
    float life, maxLife, size;
    FireworkType type;
    bool isTail, canExplodeAgain, isDualColor;
    float rotationAngle;  // èºæ—‹çƒŸèŠ±ç”¨
    std::string imagePath;  // å›¾ç‰‡çƒŸèŠ±ç”¨
};
```

#### 4.2 ç‰©ç†æ¨¡æ‹Ÿ

**é‡åŠ›ä¸ç©ºæ°”é˜»åŠ›**ï¼š

```cpp
void update(float deltaTime) {
    p.velocity += glm::vec3(0, gravity, 0) * dt;  // gravity = -9.8
    p.velocity *= 0.993f;  // ç©ºæ°”é˜»åŠ›
    p.position += p.velocity * dt;
    p.life -= dt;
}
```

**æ‹–å°¾ç²’å­**ï¼š

```cpp
Particle tail = parent;
tail.position = prevPos;  // ä¸Šä¸€å¸§ä½ç½®
tail.isTail = true;
tail.life = 0.3f;  // çŸ­ç”Ÿå‘½å‘¨æœŸ
tail.velocity = glm::vec3(0.0f);  // é™æ­¢
tail.color.a *= 0.5f;  // åŠé€æ˜
```

#### 4.3 å…­ç§çƒŸèŠ±ç±»å‹å®ç°

**çƒå½¢çƒŸèŠ±ï¼ˆå‡åŒ€åˆ†å¸ƒï¼‰**ï¼š

```cpp
float theta = u * 2Ï€;  // æ–¹ä½è§’
float phi = acos(2v - 1);  // æè§’ï¼ˆå‡åŒ€åˆ†å¸ƒï¼‰
velocity = vec3(sin(phi)*cos(theta), sin(phi)*sin(theta), cos(phi)) * radius;
```

**ç¯å½¢çƒŸèŠ±ï¼ˆæ°´å¹³åœ†ç¯ï¼‰**ï¼š

```cpp
float angle = (i / count) * 2Ï€;
velocity = vec3(cos(angle)*r, 0.5+random, sin(angle)*r);
```

**å¿ƒå½¢çƒŸèŠ±ï¼ˆå‚æ•°æ–¹ç¨‹ï¼‰**ï¼š

```cpp
float x = 16 * pow(sin(t), 3);
float y = 13*cos(t) - 5*cos(2t) - 2*cos(3t) - cos(4t);
velocity = vec3(x, y, random_z) * scale;
```

**èºæ—‹çƒŸèŠ±ï¼ˆæ—‹è½¬æ‰©æ•£ï¼‰**ï¼š

```cpp
// æ›´æ–°æ—¶æ—‹è½¬é€Ÿåº¦æ–¹å‘
p.rotationAngle += dt * 3.0f;
float radius = length(vec2(p.velocity.x, p.velocity.z));
p.velocity.x = radius * cos(p.rotationAngle);
p.velocity.z = radius * sin(p.rotationAngle);
```

**å¤šå±‚çƒŸèŠ±ï¼ˆ3å±‚ä¸åŒåŠå¾„ï¼‰**ï¼š

```cpp
for (int layer = 0; layer < 3; layer++) {
    float layerRadius = baseRadius + layer * 0.3;
    // æ¯å±‚ä¸åŒé¢œè‰²å˜åŒ–
    if (layer == 1) color = color * vec3(0.8, 1.2, 0.9);
    // å¤–å±‚å¯¿å‘½æ›´é•¿
    life = baseLife + layer * 0.1f;
}
```

**å›¾ç‰‡çƒŸèŠ±ï¼ˆåƒç´ é‡‡æ ·ï¼‰**ï¼š

```cpp
ImageData img = loadImage(path);  // stb_imageåŠ è½½
for (int y = 0; y < height; y++) {
    for (int x = 0; x < width; x++) {
        if (alpha < 0.1f) continue;  // è·³è¿‡é€æ˜åƒç´ 
        float posX = x * scale - offsetX;  // ä¸­å¿ƒåŒ–
        float posY = offsetY - y * scale;  // ç¿»è½¬Y
        velocity = vec3(posX, posY, 0) * expandSpeed;
        color = pixelColor * 0.2f;  // é™ä½äº®åº¦é¿å…bloom
    }
}
```

#### 4.4 åŒè‰²äºŒæ¬¡çˆ†ç‚¸

**å»¶è¿Ÿçˆ†ç‚¸æœºåˆ¶**ï¼š

```cpp
struct DelayedExplosion {
    glm::vec3 position;
    glm::vec4 color;  // ä½¿ç”¨secondaryColor
    FireworkType type;
    float timer;  // 0.1ç§’åè§¦å‘
    float radius;  // ç¬¬äºŒæ¬¡çˆ†ç‚¸èŒƒå›´æ›´å¤§
};

// ç¬¬ä¸€æ¬¡çˆ†ç‚¸æ—¶æ·»åŠ å»¶è¿Ÿäº‹ä»¶
if (!isSecondary && type != Image) {
    DelayedExplosion delayed;
    delayed.color = isDualColor ? secondaryColor : initialColor;
    delayed.timer = 0.1f;
    delayed.radius = 5.0f;
    delayedExplosions.push_back(delayed);
}
```

#### 4.5 é¢œè‰²æ¸å˜ç®—æ³•

```cpp
glm::vec4 calculateColorGradient(const Particle& p) {
    float lifeRatio = p.life / p.maxLife;
    if (lifeRatio > 0.95f) {
        // åˆå§‹5%ï¼šä¿æŒåŸè‰²
        return vec4(initialColor.rgb, 1.0);
    } else if (lifeRatio > 0.15f) {
        // ä¸­æ®µ80%ï¼šä¿æŒæ˜äº®
        return vec4(initialColor.rgb, 1.0);
    } else {
        // æœ«æ®µ15%ï¼šå¿«é€Ÿæ·¡å‡º
        float fade = lifeRatio / 0.15f;
        return vec4(initialColor.rgb * fade, 1.0);
    }
}
```

---

### 5. åŠ¨æ€å…‰ç…§ç³»ç»Ÿ

#### 5.1 ç‚¹å…‰æºç®¡ç†å™¨

```cpp
class PointLightManager {
    struct PointLight {
        glm::vec3 position, color;
        float intensity, lifetime;
        bool isPermanent;
    };
    vector<PointLight> lights;  // æœ€å¤š16ä¸ª
    
    void AddPermanentLight(...);  // åœºæ™¯å›ºå®šå…‰æº
    void AddTemporaryLight(...);  // çƒŸèŠ±ä¸´æ—¶å…‰æº
    void Update(float dt) {
        // ç§»é™¤è¿‡æœŸçš„ä¸´æ—¶å…‰æº
        lights.erase(remove_if(lights.begin(), lights.end(),
            [](auto& l) { return !l.isPermanent && l.lifetime <= 0; }));
    }
};
```

#### 5.2 Shaderä¸­çš„å¤šå…‰æºè®¡ç®—

```glsl
uniform vec3 lightPositions[16];
uniform vec3 lightColors[16];
uniform float lightIntensities[16];
uniform int numLights;

for (int i = 0; i < numLights; i++) {
    vec3 lightDir = normalize(lightPositions[i] - FragPos);
    float distance = length(lightPositions[i] - FragPos);
    float attenuation = lightIntensities[i] / (1.0 + 0.09*distance + 0.032*distance*distance);
    
    // Blinn-Phongè®¡ç®—
    vec3 result = (ambient + diffuse + specular) * attenuation * lightColors[i];
    finalColor += result;
}
```

#### 5.3 çƒŸèŠ±çˆ†ç‚¸å…‰æºè”åŠ¨

```cpp
void createExplosion(...) {
    if (lightManager && !isSecondary) {
        vec3 lightColor(initialColor.rgb);
        // ä¸»å…‰æºï¼š0.1ç§’
        lightManager->AddTemporaryLight(position, lightColor, 25.0f, 0.1f);
        // ä¸­å¿ƒå…‰çƒï¼šæ›´å¼º
        lightManager->AddTemporaryLight(position, lightColor*1.5f, 40.0f, 0.1f);
    }
}
```

---

### 6. åå¤„ç†ç³»ç»Ÿ

#### 6.1 FBOç¦»å±æ¸²æŸ“

```cpp
// åˆå§‹åŒ–
glGenFramebuffers(1, &FBO);
glBindFramebuffer(GL_FRAMEBUFFER, FBO);

// é¢œè‰²çº¹ç†é™„ä»¶
glGenTextures(1, &textureColorBuffer);
glTexImage2D(GL_TEXTURE_2D, 0, GL_RGBA, width, height, ...);
glFramebufferTexture2D(GL_FRAMEBUFFER, GL_COLOR_ATTACHMENT0, ...);

// æ·±åº¦+æ¨¡æ¿RBO
glGenRenderbuffers(1, &RBO);
glRenderbufferStorage(GL_RENDERBUFFER, GL_DEPTH24_STENCIL8, ...);
glFramebufferRenderbuffer(GL_FRAMEBUFFER, GL_DEPTH_STENCIL_ATTACHMENT, ...);
```

#### 6.2 æ·¡å…¥æ·¡å‡ºåå¤„ç†

**Shaderå®ç°**ï¼š

```glsl
uniform sampler2D scene;
uniform float fadeAlpha;

void main() {
    vec4 color = texture(scene, TexCoords);
    FragColor = vec4(color.rgb, color.a * fadeAlpha);
}
```

**ä¸ç”µå½±æ¨¡å¼è”åŠ¨**ï¼š

```cpp
float fadeAlpha = camera.GetCinematicFadeAlpha();
postProcessor->SetFadeAlpha(fadeAlpha);
postProcessor->Render();  // å…¨å±å››è¾¹å½¢
```

---

### 7. UIä¸äº¤äº’ç³»ç»Ÿ

#### 7.1 FreeTypeæ–‡æœ¬æ¸²æŸ“

```cpp
// åŠ è½½å­—ä½“
FT_Library ft;
FT_Init_FreeType(&ft);
FT_Face face;
FT_New_Face(ft, "assets/fonts/msyh.ttc", 0, &face);
FT_Set_Pixel_Sizes(face, 0, 48);

// ç”Ÿæˆå­—å½¢çº¹ç†
for (GLubyte c = 0; c < 128; c++) {
    FT_Load_Char(face, c, FT_LOAD_RENDER);
    GLuint texture;
    glGenTextures(1, &texture);
    glTexImage2D(GL_TEXTURE_2D, 0, GL_RED, 
        face->glyph->bitmap.width, face->glyph->bitmap.rows, ...);
    // å­˜å‚¨å­—å½¢ä¿¡æ¯
    Characters.insert(pair<char, Character>(c, character));
}
```

#### 7.2 ä¸­æ–‡å­—ä½“æ”¯æŒ

- ä½¿ç”¨`msyh.ttc`ï¼ˆå¾®è½¯é›…é»‘ï¼‰æˆ–`simsun.ttc`ï¼ˆå®‹ä½“ï¼‰
- FreeTypeåŠ è½½æ—¶æŒ‡å®šface indexï¼š`FT_New_Face(ft, path, 0, &face)`
- æ¸²æŸ“æ—¶é€å­—ç¬¦æŸ¥è¯¢å­—å½¢çº¹ç†å¹¶æ‹¼æ¥

#### 7.3 è‰ºæœ¯å­—åŠ¨ç”»

```cpp
// F1-F6è§¦å‘ä¸åŒæ•ˆæœ
if (key == GLFW_KEY_F1) {
    uiManager->ShowArtText("çƒå½¢çƒŸèŠ±", 2.0f, color, AnimType::FadeIn);
}

enum AnimType { FadeIn, Scale, Rainbow, Wave };
void Update(float dt) {
    if (animType == Scale) {
        scale = 1.0f + sin(time * 3.0f) * 0.2f;
    } else if (animType == Rainbow) {
        color = HSVtoRGB(fmod(time, 1.0f), 1.0f, 1.0f);
    }
}
```

---

### 8. éŸ³æ•ˆç³»ç»Ÿ

#### 8.1 miniaudioå¼•æ“

```cpp
ma_engine audioEngine;
ma_engine_init(NULL, &audioEngine);

// æ’­æ”¾éŸ³æ•ˆ
void launch(...) {
    int index = rand() % 2;
    string path = "assets/sounds/firework/rise/firework_rise_0" + to_string(index+1) + ".wav";
    ma_engine_play_sound(&audioEngine, path.c_str(), NULL);
}

void createExplosion(...) {
    int index = rand() % 2;
    string path = "assets/sounds/firework/explosion/firework_explosion_0" + to_string(index+1) + ".wav";
    ma_engine_play_sound(&audioEngine, path.c_str(), NULL);
}
```

#### 8.2 éŸ³æ•ˆèµ„æº

- ä¸Šå‡éŸ³æ•ˆï¼š`firework_rise_01.wav`, `firework_rise_02.wav`	ç»è¿‡é™è°ƒå‡å°éŸ³é‡ç­‰éŸ³é¢‘å¤„ç†
- çˆ†ç‚¸éŸ³æ•ˆï¼š`firework_explosion_01.wav`, `firework_explosion_02.wav`
- éšæœºé€‰æ‹©ï¼Œé¿å…å•è°ƒé‡å¤

---

### 9. è‡ªåŠ¨æ¼”ç¤ºç³»ç»Ÿ

#### 9.1 runTestè‡ªåŠ¨å‘å°„

**HSVè‰²å½©ç©ºé—´ç”Ÿæˆéšæœºè‰²å¯¹**ï¼š

```cpp
auto generateRandomColorPair = []() {
    // ä¸»è‰²ï¼šHSVå…¨èŒƒå›´éšæœº
    float hue1 = rand();  // 0-1
    float sat1 = rand();
    float val1 = 0.5 + rand()*0.5;  // 0.5-1.0ç¡®ä¿ä¸å¤ªæš—
    vec4 primary = HSVtoRGB(hue1, sat1, val1);
    
    // è¾…è‰²ï¼šè‰²ç›¸åç§»-0.2~0.2
    float hue2 = fmod(hue1 + (rand()*0.4-0.2) + 1.0, 1.0);
    float sat2 = clamp(sat1 + rand()*0.3-0.15, 0, 1);
    vec4 secondary = HSVtoRGB(hue2, sat2, val2);
    return {primary, secondary};
};
```

**æ¦‚ç‡åŠ æƒé€‰æ‹©**ï¼š

```cpp
float roll = rand();
if (roll < 0.15) {  // 15%æ¦‚ç‡
    type = Image;
    skipNextLaunch = true;  // å›¾ç‰‡çƒŸèŠ±åè·³è¿‡ä¸€å¸§
} else if (roll < 0.45) {  // 35%æ¦‚ç‡
    type = Sphere;  // åŒè‰²
} else if (roll < 0.80) {  // 35%æ¦‚ç‡
    type = MultiLayer;  // ä¸‰è‰²
} else {  // 15%æ¦‚ç‡
    type = Heart;  // å•è‰²
}
```

**æ—¶é—´é‡‡æ ·**ï¼š

```cpp
if (currentTime - lastTestTime < 0.8f) return;  // æ¯0.8ç§’å‘å°„ä¸€æ¬¡
lastTestTime = currentTime;
```

---

### 10. èµ„æºç®¡ç†ä¸å†…å­˜å®‰å…¨

#### 10.1 OpenGLèµ„æºæ¸…ç†

```cpp
~PostProcessor() {
    if (quadVBO) glDeleteBuffers(1, &quadVBO);
    if (quadVAO) glDeleteVertexArrays(1, &quadVAO);
    if (textureColorBuffer) glDeleteTextures(1, &textureColorBuffer);
    if (RBO) glDeleteRenderbuffers(1, &RBO);
    if (FBO) glDeleteFramebuffers(1, &FBO);
}

// main.cppä¸­
try {
    if (postProcessor) { delete postProcessor; postProcessor = nullptr; }
    if (skyboxShader) { delete skyboxShader; skyboxShader = nullptr; }
    fireworkSystem.cleanupGL();
    skybox.cleanup();
    ground.cleanup();
    if (uiManager) { uiManager->Cleanup(); delete uiManager; }
} catch (exception& e) {
    cerr << "OpenGL cleanup error: " << e.what() << endl;
}
glfwTerminate();  // æœ€åé”€æ¯ä¸Šä¸‹æ–‡
```

#### 10.2 èµ„æºåŠ è½½å®¹é”™

- **çº¹ç†åŠ è½½å¤±è´¥**ï¼šè¿”å›é»˜è®¤çº¹ç†æˆ–è·³è¿‡ï¼Œä¸ä¸­æ–­ç¨‹åº
- **æ¨¡å‹åŠ è½½å¤±è´¥**ï¼šè¾“å‡ºé”™è¯¯æ—¥å¿—ï¼Œä½¿ç”¨é»˜è®¤å‡ ä½•ä½“
- **éŸ³é¢‘åˆå§‹åŒ–å¤±è´¥**ï¼šé™éŸ³è¿è¡Œï¼Œä¸å½±å“è§†è§‰æ•ˆæœ





## ğŸ› äº”ã€é‡åˆ°çš„é—®é¢˜ä¸è§£å†³è¿‡ç¨‹

### é—®é¢˜1ï¼šç”µå½±è¿é•œé˜¶æ®µåˆ‡æ¢çš„è·³å˜æ„Ÿ

**é—®é¢˜æè¿°**ï¼š  
åˆæœŸå®ç°ç”µå½±æ¨¡å¼æ—¶ï¼Œä»é«˜ç©ºä¿¯ç°åˆ‡æ¢åˆ°ç¯ç»•é£è¡Œæ—¶ï¼Œæ‘„åƒæœºä½ç½®çªç„¶æ”¹å˜ï¼Œäº§ç”Ÿæ˜æ˜¾çš„"ç¬ç§»"æ•ˆæœï¼Œç ´åäº†æµç•…çš„è§‚å½±ä½“éªŒã€‚ä¾‹å¦‚åœ¨3.5ç§’æ—¶åˆ»ï¼Œæ‘„åƒæœºä»ï¼ˆ4, 4, 17ï¼‰çªå˜åˆ°ï¼ˆ26, 5.5, 22ï¼‰ï¼Œè§†è§’ç¬é—´è·³è·ƒã€‚

**æ ¹æœ¬åŸå› **ï¼š  
ä½¿ç”¨çº¿æ€§æ’å€¼ï¼ˆ`glm::mix`ï¼‰æ—¶ï¼Œæ’å€¼å› å­ä»0çªå˜åˆ°1ï¼Œå¯¼è‡´ä½ç½®/è§’åº¦ç›´æ¥è·³åˆ°ç›®æ ‡å€¼ï¼Œè€Œéå¹³æ»‘è¿‡æ¸¡ã€‚åŒæ—¶ï¼Œä¸åŒé˜¶æ®µçš„èµ·å§‹ä½ç½®è®¡ç®—ä¸è¿è´¯ï¼Œå‰ä¸€é˜¶æ®µçš„ç»“æŸä½ç½®ä¸åä¸€é˜¶æ®µçš„å¼€å§‹ä½ç½®å­˜åœ¨åå·®ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š  

1. **å¼•å…¥smoothstepæ’å€¼**ï¼š

```cpp
float smoothstep(float edge0, float edge1, float x) {
    x = glm::clamp((x - edge0) / (edge1 - edge0), 0.0f, 1.0f);
    return x * x * (3.0f - 2.0f * x);  // Hermiteæ’å€¼æ›²çº¿
}
// åº”ç”¨äºç¬¬ä¸‰é˜¶æ®µ
float phase = (t - 8.5f) / 2.5f;
phase = smoothstep(0.0f, 1.0f, phase);
Position = glm::mix(startPos, endPos, phase);
```

2. **æ·»åŠ æ·¡å…¥æ·¡å‡ºé®æŒ¡**ï¼š
   åœ¨é˜¶æ®µåˆ‡æ¢æ—¶ï¼ˆ3.0-4.0s, 8.0-9.0sï¼‰ï¼Œè¿”å›alphaå€¼ä»1.0é™è‡³0.0å†å‡è‡³1.0ï¼Œåœ¨åå¤„ç†shaderä¸­åº”ç”¨ï¼š

```cpp
float alpha = camera.GetCinematicFadeAlpha();
FragColor = vec4(sceneColor.rgb, alpha);
```

æ·¡å‡ºæ—¶ç”»é¢å˜é»‘ï¼Œé®æŒ¡ä½ç½®è·³å˜ï¼Œæ·¡å…¥æ—¶æ–°é˜¶æ®µå·²å°±ä½ï¼Œç”¨æˆ·æ„ŸçŸ¥ä¸åˆ°ç¬ç§»ã€‚

3. **ç¡®ä¿ä½ç½®è¿ç»­æ€§**ï¼š
   æ‰‹åŠ¨è°ƒæ•´å„é˜¶æ®µçš„èµ·å§‹/ç»“æŸä½ç½®ï¼Œç¡®ä¿å‰ä¸€é˜¶æ®µçš„`endPos`ä¸åä¸€é˜¶æ®µçš„`startPos`ä¸€è‡´ã€‚

**æ•ˆæœ**ï¼š  
é˜¶æ®µåˆ‡æ¢å˜å¾—å¹³æ»‘è‡ªç„¶ï¼Œsmoothstepæä¾›äº†ç¼“å…¥ç¼“å‡ºçš„åŠ é€Ÿåº¦æ›²çº¿ï¼Œæ·¡å…¥æ·¡å‡ºè¿›ä¸€æ­¥æ©ç›–äº†å¾®å°çš„ä¸è¿ç»­æ€§ï¼Œæ•´ä½“è§‚æ„Ÿæ¥è¿‘ç”µå½±çº§é•œå¤´è¿åŠ¨ã€‚

---

### é—®é¢˜2ï¼šåœ°é¢é›¾æ•ˆä¸å¤©ç©ºç›’é¢œè‰²ä¸åŒ¹é…

**é—®é¢˜æè¿°**ï¼š  
åœ°é¢é›¾æ•ˆä½¿ç”¨ç°è‰²ï¼ˆ0.5, 0.5, 0.5ï¼‰ï¼Œå¤©ç©ºç›’äº®åº¦ä¸º100%ï¼Œå¯¼è‡´åœ°å¹³çº¿å¤„å‡ºç°æ˜æ˜¾çš„è‰²å½©æ–­å±‚ã€‚è¿œå¤„åœ°é¢æ˜¯ç°è‰²ï¼Œä½†æŠ¬å¤´çœ‹åˆ°çš„å¤©ç©ºå´æ˜¯äº®è“è‰²ï¼Œç¼ºä¹ç»Ÿä¸€çš„å¤œæ™¯æ°›å›´ã€‚åŒæ—¶ï¼ŒçƒŸèŠ±åœ¨è¿œå¤„æ—¶è¢«ç°è‰²é›¾æ•ˆæ·¹æ²¡ï¼Œè§†è§‰å†²å‡»åŠ›ä¸‹é™ã€‚

**æ ¹æœ¬åŸå› **ï¼š  

1. é›¾æ•ˆé¢œè‰²ä¸å¤©ç©ºç›’åº•è‰²ä¸åè°ƒ
2. å¤©ç©ºç›’è¿‡äº®ï¼Œä¸ç¬¦åˆå¤œæ™¯è®¾å®š
3. é›¾æ•ˆå¯†åº¦è¿‡é«˜ï¼Œè¿œå¤„ç‰©ä½“è¿‡å¿«æ¶ˆå¤±

**è§£å†³æ–¹æ¡ˆ**ï¼š  

1. **ç»Ÿä¸€é¢œè‰²åŸºè°ƒ**ï¼š

```glsl
// ground.fs å’Œ model.fs
vec3 fogColor = vec3(0.02, 0.04, 0.12);  // æ·±è“åé»‘ï¼ŒåŒ¹é…å¤œç©º
```

2. **é™ä½å¤©ç©ºç›’äº®åº¦**ï¼š

```glsl
// skybox.fs
FragColor = texture(skybox, TexCoords) * 0.3;  // é™è‡³30%äº®åº¦
```

3. **ä¼˜åŒ–é›¾æ•ˆå‚æ•°**ï¼š

```glsl
// é™ä½å¯†åº¦ï¼Œå»¶é•¿èµ·å§‹è·ç¦»
fogDensity = 0.030;  // åŸ0.05
fogStart = 15.0;     // åŸ10.0
```

4. **å·®å¼‚åŒ–åœ°é¢ä¸æ¨¡å‹é›¾æ•ˆ**ï¼š

```glsl
// åœ°é¢é›¾æ•ˆæ›´å¼ºï¼ˆæ›´å¿«æ¶ˆå¤±ï¼‰
float distance = length(FragPos - viewPos);
float fogFactor = exp(-fogDensity * max(0.0, distance - fogStart));

// æ¨¡å‹é›¾æ•ˆå‡åŠï¼ˆä¿æŒå¯è§ï¼‰
float modelFogDensity = fogDensity * 0.5;  // model.fs
```

**æ•ˆæœ**ï¼š  
åœ°å¹³çº¿å¤„é¢œè‰²å¹³æ»‘è¿‡æ¸¡ï¼Œè¿œå¤„åœ°é¢é€æ¸èå…¥å¤œç©ºï¼ŒçƒŸèŠ±åœ¨è¿œå¤„ä»èƒ½ä¿æŒè¾ƒé«˜å¯è§åº¦ï¼Œæ•´ä½“ç”»é¢åè°ƒç»Ÿä¸€ã€‚

---

### é—®é¢˜3ï¼šAssimpåŠ è½½æ¨¡å‹çº¹ç†å¤±è´¥

**é—®é¢˜æè¿°**ï¼š  
ä½¿ç”¨AssimpåŠ è½½ä¹¦æœ¬æ¨¡å‹æ—¶ï¼Œæ¨¡å‹æ˜¾ç¤ºä¸ºçº¯ç™½è‰²æˆ–çº¯é»‘è‰²ï¼Œæ§åˆ¶å°è¾“å‡º"Texture failed to load at path: xxx"ã€‚æ£€æŸ¥å‘ç°Assimpè§£æçš„çº¹ç†è·¯å¾„ä¸å®é™…æ–‡ä»¶ä½ç½®ä¸åŒ¹é…ï¼Œä¾‹å¦‚è§£æå‡ºçš„è·¯å¾„ä¸ºç»å¯¹è·¯å¾„`D:\Models\book.png`ï¼Œä½†å®é™…æ–‡ä»¶åœ¨`assets/model/book/textures/book.png`ã€‚

**æ ¹æœ¬åŸå› **ï¼š  
ä¸åŒ3Då»ºæ¨¡è½¯ä»¶ï¼ˆBlender/3ds Max/Mayaï¼‰å¯¼å‡ºçš„FBX/OBJæ–‡ä»¶ï¼Œå…¶å†…åµŒçš„çº¹ç†è·¯å¾„æ ¼å¼ä¸ä¸€è‡´ï¼š

- æœ‰çš„æ˜¯ç»å¯¹è·¯å¾„
- æœ‰çš„æ˜¯ç›¸å¯¹äºæ¨¡å‹æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„
- æœ‰çš„åªæœ‰è£¸æ–‡ä»¶å

Assimpç›´æ¥ä½¿ç”¨è¿™äº›è·¯å¾„åŠ è½½çº¹ç†ï¼Œä½†å®é™…æ–‡ä»¶é€šå¸¸å·²ç§»åŠ¨åˆ°é¡¹ç›®èµ„æºç›®å½•ï¼Œå¯¼è‡´è·¯å¾„å¤±æ•ˆã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š  
å®ç°å¤šè·¯å¾„æœç´¢æœºåˆ¶ï¼š

```cpp
string TextureFromFile(const char* path, const string& directory) {
    string filename = string(path);
    
    // 1. æå–è£¸æ–‡ä»¶åï¼ˆå»é™¤è·¯å¾„ï¼‰
    size_t pos = filename.find_last_of("/\\");
    if (pos != string::npos) {
        filename = filename.substr(pos + 1);
    }
    
    // 2. æŒ‰ä¼˜å…ˆçº§æœç´¢å¤šä¸ªè·¯å¾„
    vector<string> searchPaths = {
        directory + "/" + filename,              // æ¨¡å‹ç›®å½•
        directory + "/textures/" + filename,     // æ¨¡å‹ç›®å½•/textures
        directory + "/../textures/" + filename,  // çˆ¶ç›®å½•/textures
        filename                                 // å½“å‰ç›®å½•
    };
    
    for (const auto& testPath : searchPaths) {
        ifstream file(testPath);
        if (file.good()) {
            return testPath;  // æ‰¾åˆ°ç¬¬ä¸€ä¸ªå­˜åœ¨çš„æ–‡ä»¶
        }
    }
    
    cerr << "Texture not found: " << path << endl;
    return "";  // æœªæ‰¾åˆ°è¿”å›ç©ºï¼Œåç»­è·³è¿‡çº¹ç†
}
```

**é™„åŠ æªæ–½**ï¼š

- åœ¨æ¨¡å‹åŠ è½½æ—¶è¾“å‡ºçº¹ç†æœç´¢æ—¥å¿—ï¼Œä¾¿äºè°ƒè¯•
- ä¸ºæ¨¡å‹æ·»åŠ `HasTextures()`æ–¹æ³•ï¼Œshaderæ ¹æ®æ­¤æ ‡å¿—å†³å®šæ˜¯å¦ä½¿ç”¨çº¹ç†
- çº¹ç†åŠ è½½å¤±è´¥æ—¶ä¸ä¸­æ–­ç¨‹åºï¼Œä½¿ç”¨é»˜è®¤é¢œè‰²æ¸²æŸ“

**æ•ˆæœ**ï¼š  
æˆåŠŸåŠ è½½ä¸åŒæ¥æºçš„æ¨¡å‹çº¹ç†ï¼Œå…¼å®¹æ€§å¤§å¹…æå‡ï¼Œå³ä½¿çº¹ç†è·¯å¾„é”™è¯¯ä¹Ÿèƒ½é€šè¿‡å¤šè·¯å¾„æœç´¢æ‰¾åˆ°æ–‡ä»¶ã€‚

---

### é—®é¢˜4ï¼šçƒŸèŠ±ç²’å­å åŠ å¯¼è‡´é¢œè‰²è¿‡äº®

**é—®é¢˜æè¿°**ï¼š  
å¤šä¸ªçƒŸèŠ±åŒæ—¶çˆ†ç‚¸æ—¶ï¼Œç²’å­å åŠ åŒºåŸŸå‡ºç°è¿‡æ›æ•ˆæœï¼Œé¢œè‰²å˜æˆçº¯ç™½è‰²ï¼Œå¤±å»äº†åŸæœ‰çš„è‰²å½©å±‚æ¬¡ã€‚ç‰¹åˆ«æ˜¯åŒè‰²äºŒæ¬¡çˆ†ç‚¸æ—¶ï¼Œå åŠ åŒºåŸŸå‡ ä¹æ— æ³•è¾¨è¯†çƒŸèŠ±ç±»å‹ã€‚

**æ ¹æœ¬åŸå› **ï¼š  
ä½¿ç”¨åŠ æ³•æ··åˆæ¨¡å¼ï¼ˆ`glBlendFunc(GL_ONE, GL_ONE)`ï¼‰ï¼Œå¤šä¸ªç²’å­é¢œè‰²ç›´æ¥ç›¸åŠ ï¼Œè¶…è¿‡1.0åè¢«clampåˆ°1.0ï¼Œå¯¼è‡´é¥±å’Œè¿‡æ›ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š  

1. **æ”¹ç”¨æ ‡å‡†alphaæ··åˆ**ï¼š

```cpp
glBlendFunc(GL_ONE, GL_ONE_MINUS_SRC_ALPHA);  // æ ‡å‡†alphaæ··åˆ
```

ç²’å­é¢œè‰²æ ¹æ®alphaå€¼æ··åˆï¼Œè€Œéç›´æ¥ç›¸åŠ ã€‚

2. **é™ä½ç²’å­é¢œè‰²å¼ºåº¦**ï¼š

```cpp
// å›¾ç‰‡çƒŸèŠ±ç²’å­é¢œè‰²ä¹˜ä»¥0.2
p.color = pixelColor * 0.2f;

// æ™®é€šçƒŸèŠ±åˆå§‹äº®åº¦ä¸è¶…è¿‡1.0
vec4 color = HSVtoRGB(h, s, v);  // væ§åˆ¶åœ¨0.5-1.0
```

3. **ä¼˜åŒ–é¢œè‰²æ¸å˜**ï¼š

```cpp
// å»¶é•¿é¢œè‰²ä¿æŒæ—¶é—´ï¼Œç¼©çŸ­åˆå§‹çˆ†äº®é˜¶æ®µ
if (lifeRatio > 0.95f) {  // åªæœ‰æœ€åˆ5%æ—¶é—´çˆ†äº®
    return initialColor;
} else if (lifeRatio > 0.15f) {  // ä¸­æ®µ80%ä¿æŒåŸè‰²
    return initialColor;
} else {  // æœ«æ®µ15%å¿«é€Ÿæ·¡å‡º
    return initialColor * (lifeRatio / 0.15f);
}
```

**æ•ˆæœ**ï¼š  
ç²’å­å åŠ æ—¶é¢œè‰²è‡ªç„¶æ··åˆï¼Œä¿ç•™äº†è‰²å½©å±‚æ¬¡ï¼Œç”»é¢ä¸å†è¿‡æ›ï¼ŒçƒŸèŠ±ç±»å‹æ¸…æ™°å¯è¾¨ã€‚

---

### é—®é¢˜5ï¼šç”µå½±æ¨¡å¼ä¸è‡ªåŠ¨æµ‹è¯•å†²çª

**é—®é¢˜æè¿°**ï¼š  
åŒæ—¶å¯åŠ¨ç”µå½±æ¨¡å¼ï¼ˆæŒ‰é”®9ï¼‰å’Œè‡ªåŠ¨æµ‹è¯•ï¼ˆæŒ‰é”®0ï¼‰æ—¶ï¼Œæ‘„åƒæœºè¢«è‡ªåŠ¨æµ‹è¯•çš„éšæœºä½ç½®è¦†ç›–ï¼Œç”µå½±è¿é•œå¤±æ•ˆã€‚æˆ–è€…ç”µå½±æ¨¡å¼ç»“æŸåï¼Œæ‘„åƒæœºä½ç½®ä¸æ¢å¤ï¼Œåç»­æ“ä½œå¼‚å¸¸ã€‚

**æ ¹æœ¬åŸå› **ï¼š  
ä¸¤ä¸ªæ¨¡å¼éƒ½å°è¯•æ§åˆ¶æ‘„åƒæœºä½ç½®ï¼Œç¼ºä¹ä¼˜å…ˆçº§ç®¡ç†å’Œäº’æ–¥é€»è¾‘ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š  

1. **æ·»åŠ æ¨¡å¼äº’æ–¥æ£€æŸ¥**ï¼š

```cpp
void ToggleCinematicMode() {
    CinematicMode = !CinematicMode;
    if (CinematicMode) {
        OrbitMode = false;  // ç¦ç”¨è½¨é“æ¨¡å¼
        CinematicTime = 0.0f;
        CinematicInitialPos = Position;  // ä¿å­˜åˆå§‹ä½ç½®
    }
}

void ProcessKeyboard(...) {
    if (CinematicMode || OrbitMode) return;  // ç‰¹æ®Šæ¨¡å¼ä¸‹ç¦æ­¢æ‰‹åŠ¨æ§åˆ¶
}
```

2. **æ¨¡å¼ç»“æŸåæ¢å¤çŠ¶æ€**ï¼š

```cpp
if (t > 11.0f) {
    CinematicMode = false;
    // å¯é€‰ï¼šæ¢å¤åˆ°åˆå§‹ä½ç½®
    // Position = CinematicInitialPos;
}
```

3. **UIæç¤ºå½“å‰æ¨¡å¼**ï¼š

```cpp
if (camera.CinematicMode) {
    uiManager->RenderText("Cinematic Mode Active", ...);
}
```

**æ•ˆæœ**ï¼š  
æ¨¡å¼åˆ‡æ¢æµç•…ï¼Œäº’ä¸å¹²æ‰°ï¼Œç”¨æˆ·å¯ä»¥æ¸…æ™°çŸ¥é“å½“å‰å¤„äºå“ªç§æ¨¡å¼ã€‚

---

### é—®é¢˜6ï¼šå›¾ç‰‡çƒŸèŠ±ç²’å­æ•°è¿‡å¤šå¯¼è‡´å¡é¡¿

**é—®é¢˜æè¿°**ï¼š  
åŠ è½½é«˜åˆ†è¾¨ç‡å›¾ç‰‡ï¼ˆå¦‚512x512ï¼‰æ—¶ï¼Œæ¯ä¸ªåƒç´ éƒ½ç”Ÿæˆä¸€ä¸ªç²’å­ï¼Œå¯¼è‡´ç²’å­æ•°è¶…è¿‡26ä¸‡ï¼Œå¸§ç‡ä»60fpséª¤é™åˆ°5fpsä»¥ä¸‹ï¼Œç¨‹åºå‡ ä¹å¡æ­»ã€‚

**æ ¹æœ¬åŸå› **ï¼š  
æœªè®¾ç½®é‡‡æ ·é—´éš”ï¼Œé€åƒç´ ç”Ÿæˆç²’å­ï¼Œç²’å­æ•° = å›¾ç‰‡åˆ†è¾¨ç‡ï¼ŒGPUæ¸²æŸ“å‹åŠ›è¿‡å¤§ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š  

1. **æ·»åŠ é‡‡æ ·é—´éš”**ï¼š

```cpp
int sampleRate = 1;  // æ¯éš”1ä¸ªåƒç´ é‡‡æ ·
for (int y = 0; y < height; y += sampleRate) {
    for (int x = 0; x < width; x += sampleRate) {
        // ç”Ÿæˆç²’å­
    }
}
```

é‡‡æ ·é—´éš”=1æ—¶ï¼Œç²’å­æ•°ä¸ºåŸæ¥çš„1/1ï¼›é—´éš”=3æ—¶ï¼Œç²’å­æ•°ä¸ºåŸæ¥çš„1/9ã€‚

2. **è·³è¿‡é€æ˜åƒç´ **ï¼š

```cpp
if (pixelColor.a < 0.1f) continue;  // alpha < 0.1è§†ä¸ºé€æ˜
```

3. **å›¾ç‰‡ç¼©æ”¾é€‚é…**ï¼š

```cpp
float scale = min(4.0f / width, 4.0f / height);  // é™åˆ¶åœ¨4x4å•ä½å†…
```

4. **ç²’å­å°ºå¯¸è°ƒæ•´**ï¼š

```cpp
p.size = 0.02f;  // è¾ƒå°çš„ç²’å­å°ºå¯¸ï¼Œé¿å…è¿‡åº¦å¡«å……
```

**æ€§èƒ½å¯¹æ¯”**ï¼š

- 512x512æ— é‡‡æ ·ï¼š260Kç²’å­ï¼Œ5fps
- 512x512é‡‡æ ·é—´éš”=3ï¼š29Kç²’å­ï¼Œ55fps
- 200x200é‡‡æ ·é—´éš”=1ï¼š40Kç²’å­ï¼ˆè·³è¿‡é€æ˜ï¼‰ï¼Œ60fpsï¼ˆæ¨èï¼‰

**å»ºè®®**ï¼š  
ä½¿ç”¨200x200ä»¥å†…çš„PNGå›¾ç‰‡ï¼Œé‡‡æ ·é—´éš”è®¾ä¸º1ï¼Œè·³è¿‡é€æ˜åƒç´ ï¼Œå¯è·å¾—æœ€ä½³è§†è§‰æ•ˆæœå’Œæ€§èƒ½å¹³è¡¡ã€‚

---

### é—®é¢˜7ï¼šOpenGLèµ„æºæ¸…ç†æ—¶ç¨‹åºå´©æºƒ

**é—®é¢˜æè¿°**ï¼š  
ç¨‹åºé€€å‡ºæ—¶ï¼Œåœ¨`glfwTerminate()`åè®¿é—®OpenGLå¯¹è±¡å¯¼è‡´è®¿é—®è¿ä¾‹å´©æºƒã€‚æˆ–è€…åœ¨æ¸…ç†shaderæ—¶ï¼Œç”±äºå¤šæ¬¡deleteåŒä¸€å¯¹è±¡å¯¼è‡´double freeé”™è¯¯ã€‚

**æ ¹æœ¬åŸå› **ï¼š  

1. OpenGLå¯¹è±¡å¿…é¡»åœ¨ä¸Šä¸‹æ–‡é”€æ¯å‰æ¸…ç†
2. æ¸…ç†é¡ºåºé”™è¯¯ï¼Œå…ˆé”€æ¯ä¸Šä¸‹æ–‡å†åˆ é™¤å¯¹è±¡
3. æŒ‡é’ˆæœªç½®ç©ºï¼Œé‡å¤delete

**è§£å†³æ–¹æ¡ˆ**ï¼š  

1. **ä¸¥æ ¼çš„æ¸…ç†é¡ºåº**ï¼š

```cpp
// 1. å…ˆæ¸…ç†OpenGLèµ„æº
if (postProcessor) {
    delete postProcessor;
    postProcessor = nullptr;
}
if (skyboxShader) {
    delete skyboxShader;
    skyboxShader = nullptr;
}
fireworkSystem.cleanupGL();
skybox.cleanup();
ground.cleanup();

// 2. æ¸…ç†UIï¼ˆåŒ…å«OpenGLå¯¹è±¡ï¼‰
if (uiManager) {
    uiManager->Cleanup();
    delete uiManager;
    uiManager = nullptr;
}

// 3. æœ€åé”€æ¯GLFWä¸Šä¸‹æ–‡
glfwTerminate();
```

2. **æ·»åŠ å¼‚å¸¸æ•è·**ï¼š

```cpp
try {
    // æ¸…ç†ä»£ç 
} catch (exception& e) {
    cerr << "OpenGL cleanup error: " << e.what() << endl;
}
```

3. **é˜²å¾¡æ€§æ£€æŸ¥**ï¼š

```cpp
~PostProcessor() {
    if (quadVBO) {
        glDeleteBuffers(1, &quadVBO);
        quadVBO = 0;  // ç½®é›¶é˜²æ­¢é‡å¤åˆ é™¤
    }
}
```

4. **æ ‡è®°å·²æ¸…ç†çŠ¶æ€**ï¼š

```cpp
bool glInited = false;  // Shader/VAOç­‰å¯¹è±¡æ ‡å¿—
void cleanupGL() {
    if (!glInited) return;  // é˜²æ­¢é‡å¤æ¸…ç†
    // æ‰§è¡Œæ¸…ç†
    glInited = false;
}
```

**æ•ˆæœ**ï¼š  
ç¨‹åºé€€å‡ºæ—¶ä¸å†å´©æºƒï¼Œæ‰€æœ‰OpenGLèµ„æºæ­£ç¡®é‡Šæ”¾ï¼Œæ²¡æœ‰å†…å­˜æ³„æ¼ã€‚

---

### é—®é¢˜8ï¼šç²’å­æ‹–å°¾ç”Ÿå‘½å‘¨æœŸè¿‡é•¿å¯¼è‡´ç”»é¢æ¨¡ç³Š

**é—®é¢˜æè¿°**ï¼š  
æ‹–å°¾ç²’å­ç”Ÿå‘½å‘¨æœŸè®¾ä¸º1.0ç§’æ—¶ï¼Œå±å¹•ä¸Šç§¯ç´¯å¤§é‡æ‹–å°¾ï¼Œé®æŒ¡äº†çƒŸèŠ±æœ¬ä½“ï¼Œç”»é¢å˜å¾—æ¨¡ç³Šä¸æ¸…ã€‚åŒæ—¶æ‹–å°¾ç²’å­æ•°é‡è¿‡å¤šï¼ˆæ¯ä¸ªä¸»ç²’å­æ¯å¸§ç”Ÿæˆä¸€ä¸ªæ‹–å°¾ï¼‰ï¼Œå¸§ç‡ä¸‹é™ã€‚

**æ ¹æœ¬åŸå› **ï¼š  

1. æ‹–å°¾å¯¿å‘½è¿‡é•¿ï¼Œæ¶ˆå¤±é€Ÿåº¦æ…¢
2. æ‹–å°¾ç”Ÿæˆé¢‘ç‡è¿‡é«˜ï¼ˆæ¯å¸§ç”Ÿæˆï¼‰
3. æ‹–å°¾é€æ˜åº¦è¿‡é«˜

**è§£å†³æ–¹æ¡ˆ**ï¼š  

1. **ç¼©çŸ­æ‹–å°¾å¯¿å‘½**ï¼š

```cpp
tail.life = 0.3f;  // åŸ1.0ç§’æ”¹ä¸º0.3ç§’
tail.maxLife = 0.3f;
```

2. **é™ä½æ‹–å°¾é€æ˜åº¦**ï¼š

```cpp
tail.color.a *= 0.5f;  // åŠé€æ˜
tail.initialColor.a *= 0.5f;
```

3. **æ‹–å°¾å¤§å°è¡°å‡**ï¼š

```cpp
float t = 1.0f - (tail.life / tail.maxLife);
tail.size = max(0.01f, tail.size * (1.0f - t * 0.05f));
```

4. **æ¡ä»¶ç”Ÿæˆæ‹–å°¾**ï¼š

```cpp
if (!p.isTail && p.velocity.y > 0) {  // åªåœ¨ä¸Šå‡é˜¶æ®µç”Ÿæˆ
    createTail(p, prevPos);
}
```

**æ•ˆæœ**ï¼š  
æ‹–å°¾æ¸…æ™°å¯è§ä½†ä¸é®æŒ¡ä¸»ä½“ï¼Œç”»é¢æ¸…çˆ½ï¼Œå¸§ç‡ç¨³å®šåœ¨60fpsã€‚

---

### æ€»ç»“ï¼šæ ¸å¿ƒç»éªŒæ•™è®­

1. **å¹³æ»‘è¿‡æ¸¡çš„é‡è¦æ€§**ï¼šæ‰€æœ‰æ¶‰åŠè¿ç»­å˜åŒ–çš„å‚æ•°ï¼ˆä½ç½®ã€è§’åº¦ã€é¢œè‰²ã€é€æ˜åº¦ï¼‰éƒ½åº”ä½¿ç”¨æ’å€¼å‡½æ•°ï¼ˆlerp/smoothstep/easeï¼‰ï¼Œé¿å…çªå˜ã€‚

2. **é¢œè‰²åè°ƒæ€§**ï¼šåœºæ™¯ä¸­æ‰€æœ‰å…ƒç´ ï¼ˆå¤©ç©ºç›’ã€é›¾æ•ˆã€å…‰ç…§ã€ç²’å­ï¼‰çš„é¢œè‰²åŸºè°ƒåº”ç»Ÿä¸€ï¼Œåœ°å¹³çº¿å¤„å°¤å…¶éœ€è¦æ³¨æ„è¿‡æ¸¡ã€‚

3. **è·¯å¾„å®¹é”™æœºåˆ¶**ï¼šåŠ è½½å¤–éƒ¨èµ„æºï¼ˆçº¹ç†ã€æ¨¡å‹ã€éŸ³é¢‘ï¼‰æ—¶ï¼Œåº”å®ç°å¤šè·¯å¾„æœç´¢å’Œé™çº§æ–¹æ¡ˆï¼Œæå‡å…¼å®¹æ€§ã€‚

4. **æ€§èƒ½ä¼˜åŒ–æ„è¯†**ï¼šç²’å­æ•°é‡ã€çº¹ç†åˆ†è¾¨ç‡ã€ç»˜åˆ¶è°ƒç”¨éƒ½ä¼šå½±å“æ€§èƒ½ï¼Œåº”é€šè¿‡é‡‡æ ·ã€å‰”é™¤ã€LODç­‰æ‰‹æ®µä¼˜åŒ–ã€‚

5. **èµ„æºç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼šOpenGLèµ„æºå¿…é¡»åœ¨ä¸Šä¸‹æ–‡æœ‰æ•ˆæœŸå†…æ¸…ç†ï¼Œæ¸…ç†é¡ºåºå’Œé˜²å¾¡æ€§æ£€æŸ¥è‡³å…³é‡è¦ã€‚

6. **æ¨¡å¼äº’æ–¥ä¸ä¼˜å…ˆçº§**ï¼šå¤šä¸ªæ§åˆ¶æ¨¡å¼ï¼ˆç”µå½±/è½¨é“/è‡ªç”±ï¼‰åº”äº’æ–¥ï¼Œé¿å…å†²çªï¼ŒUIåº”æ¸…æ™°æç¤ºå½“å‰çŠ¶æ€ã€‚

7. **è°ƒè¯•å‹å¥½æ€§**ï¼šå…³é”®æ“ä½œåº”è¾“å‡ºæ—¥å¿—ï¼Œçº¹ç†/æ¨¡å‹åŠ è½½å¤±è´¥åº”æœ‰æ˜ç¡®é”™è¯¯ä¿¡æ¯ï¼Œä¾¿äºå®šä½é—®é¢˜ã€‚



------

# ğŸ§¨ é¡¹ç›®æ„å»ºè¯´æ˜

------

## ğŸ—‚ ä¸€ã€é¡¹ç›®ç›®å½•ç»“æ„

```
Fireworks_OpenGL/
â”‚â”€â”€ Fireworks_OpenGL/
â”‚   â”‚â”€â”€ src/               # æ‰€æœ‰ C++ æºæ–‡ä»¶
â”‚   â”‚â”€â”€ include/           # æ‰€æœ‰å¤´æ–‡ä»¶
â”‚   â”‚â”€â”€ assets/            # èµ„æº
â”‚   â”‚   â”œâ”€â”€ shaders/
â”‚   â”‚   â”œâ”€â”€ textures/
â”‚   â”‚   â”œâ”€â”€ skybox/
â”‚   â”‚   â”œâ”€â”€ sounds/
â”‚   â”‚   â”œâ”€â”€ fonts/        # UIç”¨å­—ä½“æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ model/         # 3Dæ¨¡å‹æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ ground/        # åœ°é¢çº¹ç†
â”‚   â”‚â”€â”€ external/          # ç¬¬ä¸‰æ–¹åº“ï¼ˆæºç å½¢å¼ï¼‰
â”‚   â”‚   â”œâ”€â”€ glfw/
â”‚   â”‚   â”œâ”€â”€ glad/
â”‚   â”‚   â”œâ”€â”€ glm/
â”‚â”€â”€ x64/                   # VS è‡ªåŠ¨ç”Ÿæˆï¼ˆå·²è¢« gitignore å¿½ç•¥ï¼‰
â”‚â”€â”€ Fireworks.sln
â”‚â”€â”€ .gitignore
â”‚â”€â”€ README.md
```

------

## ğŸ›  äºŒã€ç¯å¢ƒä¾èµ–

| å·¥å…·                                  | ç”¨é€”            |
| ------------------------------------- | --------------- |
| **Visual Studio 2022**                | C++17 ç¼–è¯‘ç¯å¢ƒ  |
| **CMake**                             | ç”¨äºç¼–è¯‘ GLFW   |
| **vcpkg**                             | ç”¨äºå®‰è£… Assimp |
| **Win10/Win11 ç³»ç»Ÿè‡ªå¸¦ OpenGL32.lib** | æ— éœ€å®‰è£…        |

------

## ğŸ§© ä¸‰ã€é…ç½®ç¬¬ä¸‰æ–¹åº“

### 1. é…ç½® GLFW

GLFW ä»¥**æºç å½¢å¼**æ”¾åœ¨ï¼š

```
external/glfw/
```

éœ€è¦æ‰‹åŠ¨ç¼–è¯‘ä¸€æ¬¡ã€‚

#### ç¼–è¯‘æ­¥éª¤

1. æ‰“å¼€ **CMake GUI**
2. è®¾ç½®ï¼š
   - Sourceï¼š`external/glfw/glfw-3.4`
   - Buildï¼š`external/glfw/glfw-3.4/build`
3. ç‚¹å‡» **Configure**
4. ç‚¹å‡» **Generate**
5. ç‚¹å‡» **Open Project**
6. Visual Studio ä¸­ï¼š
   - é€‰æ‹© **Release | x64**
   - Build â†’ Build Solutionï¼ˆç”Ÿæˆ glfw3.libï¼‰

ç”Ÿæˆä½ç½®ï¼š

```
external/glfw/glfw-3.4/build/src/Release/glfw3.lib
```

------

### 2. é…ç½® GLADï¼ˆå¿…é¡»ï¼‰

GLAD ä»¥æºç å½¢å¼æ”¾ç½®åœ¨ï¼š

```
external/glad/include/
external/glad/src/glad.c
```

ä½ ä¸éœ€è¦ç¼–è¯‘å®ƒï¼Œåªéœ€è¦åœ¨ VS ä¸­åŒ…å« glad.cã€‚

æ·»åŠ æ–¹å¼ï¼š

```
å³é”®é¡¹ç›® â†’ Add â†’ Existing Item â†’ external/glad/src/glad.c
```

------

### 3. GLMï¼ˆè‡ªåŠ¨å¯ç”¨ï¼‰

ä¸‹è½½è·¯å¾„ï¼š[Releases Â· g-truc/glm](https://github.com/g-truc/glm/releases)

GLM æ˜¯ header-onlyï¼Œæ— éœ€ç¼–è¯‘ï¼Œç›´æ¥ä¸‹è½½ zip ç„¶åè§£å‹åˆ°ä¸‹é¢è¿™ä¸ªè·¯å¾„ï¼š

```
external/glm/
```

------

### 4. é…ç½® Assimpâ€”â€”ä½¿ç”¨vcpkg

#### ğŸš€ å®‰è£…æ­¥éª¤

**æ­¥éª¤ 1ï¼šå®‰è£… vcpkgï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰**

å¦‚æœä½ çš„ç”µè„‘ä¸Šè¿˜æ²¡æœ‰ vcpkgï¼ŒæŒ‰ä»¥ä¸‹æ­¥éª¤å®‰è£…ï¼š

```powershell
# 1. å…‹éš† vcpkg ä»“åº“åˆ°ä»»æ„ç›®å½•ï¼ˆç¬¬ä¸€è¡Œè‡ªå·±é€‰æ‹©è·¯å¾„ï¼‰
cd C:\
git clone https://github.com/microsoft/vcpkg.git
cd vcpkg

# 2. è¿è¡Œ bootstrap è„šæœ¬
.\bootstrap-vcpkg.bat

# 3. é›†æˆåˆ° Visual Studioï¼ˆå¯é€‰ä½†æ¨èï¼‰
.\vcpkg integrate install
```

**æ­¥éª¤ 2ï¼šå®‰è£… Assimp**

```powershell
# åœ¨ vcpkg ç›®å½•ä¸‹è¿è¡Œ
.\vcpkg install assimp:x64-windows
```

å®‰è£…å®Œæˆåï¼ŒAssimp åº“ä¼šè¢«å®‰è£…åˆ°ï¼š

```
[vcpkgå®‰è£…è·¯å¾„]\installed\x64-windows\
â”œâ”€â”€ include\assimp\     # å¤´æ–‡ä»¶
â”œâ”€â”€ lib\                # Release åº“æ–‡ä»¶
â”‚   â””â”€â”€ assimp-vc143-mt.lib
â”œâ”€â”€ debug\lib\          # Debug åº“æ–‡ä»¶
â”‚   â””â”€â”€ assimp-vc143-mtd.lib
â””â”€â”€ bin\                # DLL æ–‡ä»¶
    â””â”€â”€ assimp-vc143-mt.dll
```

**æ­¥éª¤ 3ï¼šé…ç½® Visual Studio é¡¹ç›®**

æ‰“å¼€ Visual Studioï¼Œå³é”®é¡¹ç›® â†’ å±æ€§ â†’ ç¡®ä¿é…ç½®ä¸º **x64**

**3.1 é…ç½® Include ç›®å½•**

åœ¨ `C/C++ â†’ General â†’ Additional Include Directories` ä¸­æ·»åŠ ï¼š

```
$(ProjectDir)include
$(ProjectDir)external\glfw\glfw-3.4\include
$(ProjectDir)external\glad\include
$(ProjectDir)external\glm
$(VcpkgRoot)installed\x64-windows\include
```

**ç¤ºä¾‹**ï¼ˆå‡è®¾ vcpkg åœ¨ C:\vcpkgï¼‰ï¼š

```
C:\vcpkg\installed\x64-windows\include
```

**3.2 é…ç½® Library ç›®å½•**

åœ¨ `Linker â†’ General â†’ Additional Library Directories` ä¸­æ·»åŠ ï¼š

æ³¨ï¼šä¸‹é¢çš„æ‰€æœ‰Debugé…ç½®å’ŒReleaseé…ç½®çš„è®¾ç½®åªè¦åœ¨å·¦ä¸Šè§’åˆ‡æ¢Release/Debugè¿›è¡Œé…ç½®å³å¯ï¼Œå¦‚æœå«Œéº»çƒ¦å¯ä»¥åªé…ç½®Release

**Debug é…ç½®**ï¼š

```
$(ProjectDir)external\glfw\glfw-3.4\build\src\Release
$(VcpkgRoot)installed\x64-windows\debug\lib
```

**Release é…ç½®**ï¼š

```
$(ProjectDir)external\glfw\glfw-3.4\build\src\Release
$(VcpkgRoot)installed\x64-windows\lib
```

**3.3 é…ç½®é“¾æ¥åº“**

åœ¨ `Linker â†’ Input â†’ Additional Dependencies` ä¸­æ·»åŠ ï¼š

**Debug é…ç½®**ï¼š

```
glfw3.lib
opengl32.lib
assimp-vc143-mtd.lib
freetyped.lib
```

**Release é…ç½®**ï¼š

```
glfw3.lib
opengl32.lib
assimp-vc143-mt.lib
freetype.lib
```

**æ­¥éª¤ 4ï¼šå¤åˆ¶ DLL æ–‡ä»¶**

Assimp éœ€è¦ DLL æ‰èƒ½è¿è¡Œï¼Œéœ€è¦å°† DLL å¤åˆ¶åˆ°å¯æ‰§è¡Œæ–‡ä»¶ç›®å½•ï¼š

åœ¨ Visual Studio ä¸­ï¼Œé¡¹ç›® â†’ å±æ€§ â†’ ç”Ÿæˆäº‹ä»¶ â†’ ç”Ÿæˆåäº‹ä»¶ â†’ å‘½ä»¤è¡Œï¼Œæ·»åŠ ï¼š

```cmd
xcopy /y /d "$(VcpkgRoot)\installed\x64-windows\bin\assimp-vc143-mt.dll" "$(OutDir)"
```

ï¼ˆå°† `C:\vcpkg` æ›¿æ¢ä¸ºä½ çš„å®é™… vcpkg è·¯å¾„ï¼‰

### 5. é…ç½® freetype â€” ä½¿ç”¨ vcpkg(å·²å®‰è£…)

#### ä½¿ç”¨vcpkgå®‰è£…FreeType

```bash
# æ‰“å¼€PowerShellï¼Œè¿›å…¥vcpkgç›®å½•
cd C:\vcpkg  # æ ¹æ®ä½ çš„å®é™…è·¯å¾„
.\vcpkg install freetype:x64-windows
```

#### é…ç½®Visual Studioé¡¹ç›®

åœ¨é¡¹ç›®å±æ€§ä¸­æ·»åŠ ï¼š

C/C++ â†’ å¸¸è§„ â†’ é™„åŠ åŒ…å«ç›®å½•ï¼ˆæ·»åŠ ï¼‰ï¼š

```text
$(VcpkgRoot)\installed\x64-windows\include
```

é“¾æ¥å™¨ â†’ å¸¸è§„ â†’ é™„åŠ åº“ç›®å½•ï¼ˆæ·»åŠ ï¼‰ï¼š

Debugé…ç½®ï¼š

```text
$(VcpkgRoot)\installed\x64-windows\debug\lib
```

Releaseé…ç½®ï¼š

```text
$(VcpkgRoot)\installed\x64-windows\lib
```

é“¾æ¥å™¨ â†’ è¾“å…¥ â†’ é™„åŠ ä¾èµ–é¡¹ï¼ˆæ·»åŠ ï¼‰ï¼š

Debugé…ç½®ï¼š

```text
freetyped.lib
```

Releaseé…ç½®ï¼š

```text
freetype.lib
```

------

## âš™ï¸ å››ã€é…ç½® Visual Studioï¼ˆå®Œæ•´ç‰ˆï¼Œå¯ç”¨äºæ£€æŸ¥ï¼‰

å³é”®é¡¹ç›® â†’ å±æ€§ â†’ é…ç½®ï¼šRelease / Debugã€å¹³å°ï¼šx64

è¯·æ³¨æ„ï¼šä¸è¦ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Œè¿™ä¼šå½±å“åˆ°å…¶ä»–åŒå­¦ï¼Œç”¨$()è¿™ç§å®çš„æ–¹å¼é…ç½®

------

### ğŸ“Œ 1. C/C++ â†’ General â†’ Additional Include Directories

**å®Œæ•´é…ç½®**ï¼š

```
$(ProjectDir)include
$(ProjectDir)external\glfw\glfw-3.4\include
$(ProjectDir)external\glad\include
$(ProjectDir)external\glm
$(VcpkgRoot)installed\x64-windows\include
```

------

### ğŸ“Œ 2. Linker â†’ General â†’ Additional Library Directories

**Debug é…ç½®**ï¼š

```
$(ProjectDir)external\glfw\glfw-3.4\build\src\Release
$(VcpkgRoot)installed\x64-windows\debug\lib
```

**Release é…ç½®**ï¼š

```
$(ProjectDir)external\glfw\glfw-3.4\build\src\Release
$(VcpkgRoot)installed\x64-windows\lib
```

------

### ğŸ“Œ 3. Linker â†’ Input â†’ Additional Dependencies

**Debug é…ç½®**ï¼š

```
glfw3.lib
opengl32.lib
assimp-vc143-mtd.lib
```

**Release é…ç½®**ï¼š

```
glfw3.lib
opengl32.lib
assimp-vc143-mt.lib
```

------

### ğŸ“Œ 4. Build Events â†’ Post-Build Eventï¼ˆæ¨èï¼‰

Command Lineï¼š

```cmd
xcopy /y /d "$(VcpkgRoot)\installed\x64-windows\bin\assimp-vc143-mt.dll" "$(OutDir)"
xcopy /y /d "$(VcpkgRoot)\installed\x64-windows\bin\freetype.dll" "$(OutDir)"
```

